<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kriya's Poems House</title>
<style>
  :root{
    --blue:#0a5bd3; --blue2:#3399ff; --ink:#004080;
    --bg1:#eaf4ff; --bg2:#ffffff;
  }
  *{box-sizing:border-box}
  body{ margin:0; font-family: ui-rounded, system-ui, -apple-system, "Segoe UI", Roboto, "Poppins", Arial, sans-serif;
        background: linear-gradient(135deg, var(--bg1), var(--bg2)); min-height:100vh; overflow-x:hidden; }
  header{ text-align:center; padding:24px 12px; font-size: clamp(20px, 3.5vw, 34px);
          color: var(--ink); font-weight: 800; letter-spacing:.3px; }
  .wrap{ max-width:900px; margin:0 auto 80px; padding:0 16px; position:relative; z-index:2; }

  .card{ background: rgba(255,255,255,.92); border-radius:18px;
         box-shadow: 0 18px 36px rgba(0,0,0,.08); padding:16px; }

  .login{ max-width:380px; margin:0 auto; }
  input, textarea{ width:100%; border:1px solid #d8e6ff; border-radius:12px; padding:12px 14px; font-size:16px; outline:none; background:#fff; }
  textarea{ min-height:140px; resize:vertical; }
  .row{ display:flex; gap:12px; flex-wrap:wrap; }
  button{ background: var(--ink); color:#fff; border:0; border-radius:12px; padding:10px 16px; font-size:15px; cursor:pointer;
          transition:.2s transform, .2s background; }
  button:hover{ transform: translateY(-1px); background:#0b66cc; }
  .ghost{ background:#e7f1ff; color:#003b88; }
  .tabs{ display:flex; gap:8px; margin:10px 0 14px; flex-wrap:wrap; }
  .tab-btn{ background:#e7f1ff; color:#003b88; }
  .tab-btn.active{ background: var(--blue2); color:#fff; }
  .welcome{ text-align:center; color:#0b66cc; font-style:italic; margin:8px 0 12px; }
  .who{ font-size:13px; color:#5a6c8f; text-align:center; margin-bottom:8px; }

  .section{ display:none; }
  .section.active{ display:block; }

  .poem{ background:#fff; border:1px solid #edf3ff; border-radius:14px; padding:12px 12px 10px; margin-top:12px; position:relative; }
  .meta{ font-size:12.5px; color:#6a7a99; margin-top:6px; display:flex; gap:8px; flex-wrap:wrap }
  .delete{ position:absolute; right:10px; top:10px; background:#e63946; padding:6px 10px; font-size:12px; }
  .delete:hover{ background:#c92835; }
  .empty{ color:#6a7a99; font-style:italic; margin-top:8px; }

  .hearts{ pointer-events:none; position:fixed; inset:0; z-index:1 }
  .heart{ position:absolute; user-select:none; animation: float 6.5s linear forwards; filter: drop-shadow(0 6px 10px rgba(0,0,0,.08)); }
  @keyframes float{ 0%{ transform: translateY(100vh) scale(.6) rotate(0); opacity:.9 } 100%{ transform: translateY(-10vh) scale(1.1) rotate(18deg); opacity:0 } }
</style>
</head>
<body>
  <header>üíô Welcome to Kriya's Poems House üíô</header>
  <div class="wrap">

    <!-- LOGIN -->
    <div id="loginCard" class="card login">
      <h3 style="margin:6px 0 12px;color:#123c7a">Login</h3>
      <div class="row">
        <input type="email" id="email" placeholder="Email" autocomplete="username" />
        <input type="password" id="password" placeholder="Password" autocomplete="current-password" />
        <button id="loginBtn">Login</button>
        <div id="loginError" style="color:#c92835; font-size:13px"></div>
      </div>
      <p style="font-size:12.5px; color:#5c6f92; margin-top:10px">Use the two accounts you created in Firebase Auth (you + her).</p>
    </div>

    <!-- APP -->
    <div id="appCard" class="card" style="display:none">
      <div class="welcome">üíå Welcome back, my love. Every word you write here blooms in my heart. üíå</div>
      <div class="who" id="who"></div>

      <div class="tabs">
        <button id="writeTab" class="tab-btn active">‚úçÔ∏è Write Poem</button>
        <button id="viewTab" class="tab-btn">üìñ View Poems</button>
        <div style="flex:1"></div>
        <button id="logoutBtn" class="ghost">Logout</button>
      </div>

      <!-- Write Section -->
      <section id="writeSection" class="section active">
        <textarea id="poemInput" placeholder="Write your beautiful poem here..."></textarea>
        <div class="row" style="margin-top:8px">
          <button id="saveBtn">Save Poem</button>
          <button id="clearBtn" class="ghost">Clear</button>
        </div>
      </section>

      <!-- View Section -->
      <section id="viewSection" class="section">
        <div id="poemsList"></div>
      </section>
    </div>
  </div>

  <!-- floating hearts -->
  <div class="hearts" id="heartsLayer"></div>

  <script type="module">
    // Firebase v10 modular
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
    import { getDatabase, ref, push, set, onValue, query, orderByChild } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

    // üîß PASTE YOUR CONFIG HERE
    const firebaseConfig = {
       apiKey: "AIzaSyAkeuQLGRyARWRl-fyEeZWvATTcSt6mQMQ",
  authDomain: "keyupoemverse.firebaseapp.com",
  databaseURL: "https://keyupoemverse-default-rtdb.firebaseio.com",
  projectId: "keyupoemverse",
  storageBucket: "keyupoemverse.firebasestorage.app",
  messagingSenderId: "445792490698",
  appId: "1:445792490698:web:d295459f30ea921f79d033"
    };

    // Init
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    // UI refs
    const loginCard = document.getElementById('loginCard');
    const appCard   = document.getElementById('appCard');
    const loginBtn  = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const emailEl   = document.getElementById('email');
    const passEl    = document.getElementById('password');
    const errEl     = document.getElementById('loginError');
    const whoEl     = document.getElementById('who');

    const writeTab  = document.getElementById('writeTab');
    const viewTab   = document.getElementById('viewTab');
    const writeSec  = document.getElementById('writeSection');
    const viewSec   = document.getElementById('viewSection');

    const poemInput = document.getElementById('poemInput');
    const saveBtn   = document.getElementById('saveBtn');
    const clearBtn  = document.getElementById('clearBtn');
    const poemsList = document.getElementById('poemsList');

    // Tabs
    function setTab(which){
      if(which === 'write'){
        writeTab.classList.add('active'); viewTab.classList.remove('active');
        writeSec.classList.add('active'); viewSec.classList.remove('active');
      }else{
        viewTab.classList.add('active'); writeTab.classList.remove('active');
        viewSec.classList.add('active'); writeSec.classList.remove('active');
      }
    }
    writeTab.addEventListener('click', () => setTab('write'));
    viewTab.addEventListener('click', () => setTab('view'));

    // Auth
    loginBtn.addEventListener('click', async () => {
      errEl.textContent = "";
      try{
        await signInWithEmailAndPassword(auth, emailEl.value.trim(), passEl.value.trim());
      }catch(e){
        errEl.textContent = e.message || "Login failed";
      }
    });
    logoutBtn.addEventListener('click', () => signOut(auth));

    onAuthStateChanged(auth, (user) => {
      if(user){
        loginCard.style.display = 'none';
        appCard.style.display = 'block';
        whoEl.textContent = `Signed in as: ${user.email}`;
        startRealtimeListener();
      }else{
        appCard.style.display = 'none';
        loginCard.style.display = 'block';
        poemsList.innerHTML = "";
      }
    });

    // Save poem
    saveBtn.addEventListener('click', async () => {
      const text = poemInput.value.trim();
      if(!text) return;
      const user = auth.currentUser;
      if(!user){ alert("Please login first."); return; }

      const poemsRef = ref(db, 'poems');
      const newRef = push(poemsRef);
      await set(newRef, {
        text,
        authorUid: user.uid,
        authorEmail: user.email,
        timestamp: Date.now()
      });
      poemInput.value = "";
      setTab('view'); // jump to View after saving
    });
    clearBtn.addEventListener('click', () => poemInput.value = "");

    // Realtime list
    let subscribed = false;
    function startRealtimeListener(){
      if(subscribed) return; subscribed = true;
      const qRef = query(ref(db, 'poems'), orderByChild('timestamp'));
      onValue(qRef, (snap) => {
        const data = snap.val() || {};
        const items = Object.entries(data).sort((a,b) => b[1].timestamp - a[1].timestamp);
        renderPoems(items);
      });
    }

    function renderPoems(items){
      const me = auth.currentUser?.uid;
      poemsList.innerHTML = "";
      if(items.length === 0){
        poemsList.innerHTML = `<div class="empty">No poems yet. Be the first to write one ‚ú®</div>`;
        return;
      }
      for(const [id, poem] of items){
        const el = document.createElement('div');
        el.className = 'poem';
        const d = poem.timestamp ? new Date(poem.timestamp) : null;
        const dateStr = d ? d.toLocaleString('en-IN', { day:'numeric', month:'long', year:'numeric', hour:'2-digit', minute:'2-digit' }) : '';

        el.innerHTML = `
          <div style="white-space:pre-wrap; line-height:1.55; color:#0e1f44">${escapeHTML(poem.text)}</div>
          <div class="meta">
            <span>by ${escapeHTML(poem.authorEmail || 'someone')}</span>
            ${dateStr ? `<span>‚Ä¢ Written on ${dateStr}</span>` : ''}
          </div>
        `;
        if(me && poem.authorUid === me){
          const btn = document.createElement('button');
          btn.className = 'delete';
          btn.textContent = 'Delete';
          btn.addEventListener('click', async () => {
            if(confirm('Delete this poem? üíî')){
              const { set, ref } = await import("https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js");
              await set(ref(getDatabase(), 'poems/' + id), null);
            }
          });
          el.appendChild(btn);
        }
        poemsList.appendChild(el);
      }
    }

    function escapeHTML(str){
      return str.replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
    }

    // Floating hearts
    const heartsLayer = document.getElementById('heartsLayer');
    function spawnHeart(){
      const h = document.createElement('div');
      h.className = 'heart';
      h.textContent = '‚ù§';
      h.style.left = Math.random()*100 + 'vw';
      h.style.bottom = '-40px';
      h.style.fontSize = (12 + Math.random()*22) + 'px';
      h.style.color = Math.random() > 0.5 ? '#ffffff' : '#3399ff';
      heartsLayer.appendChild(h);
      setTimeout(() => h.remove(), 7000);
    }
    setInterval(spawnHeart, 350);
  </script>
</body>
</html>
